<!DOCTYPE html>
<html>

<head>
    <meta name='viewport' content='width=device-width' />
    <link href='../styles.css' rel='stylesheet' />
</head>

<body>
    <div style='display: flex; flex-direction: column;'>
        <div style='display: flex; align-items: center; justify-content: space-around;'>
            <input id='word' onfocusout='fetchSelected()' style='font-size: 2.5em; width: 5em;'></input>
            <div onclick='reveal()' style='font-size: 1.5em;'>👀</div>
        </div>
        <div id='revealed'></div>

        <!-- <h3>German</h3>
        <div style='display: flex; flex-direction: column;'>
            <div style='width: 100%; display: flex;'>
                <input style='width: 100%;' placeholder='translation'></input>
                <button>Audio</button>
            </div>
            <input placeholder='similar words (separate by ;)'></input>
            <input placeholder='expressions (separate by ;)'></input>
        </div> -->

        <p>
        <div style='display: flex; justify-content:space-around;'>
            <button onclick='post(false)' style='font-size: 2.5em; background-color: red;'>👎🏻</button>
            <button onclick='post(true)' style='font-size: 2.5em; background-color: green;'>👍🏻</button>
        </div>
        </p>
    </div>


    <script>
        let currentWord
        const post = async (remembered) => {
            const headers = { 'Content-Type': 'application/json' }
            const body = JSON.stringify({
                word: currentWord.word,
                remembered,
                pinyin: document.getElementById('pinyin').value,
                meaning: document.getElementById('meaning').value,
                sentences: document.getElementById('sentences').value
            })
            await fetch('/api/submission', { method: 'POST', headers, body })
            await fetchNext()
        }

        const reveal = async () => {
            document.getElementById('revealed').setAttribute('style', 'height: 7em; visibility: visible;')
        }

        const fetchSelected = () => {
            fetchNext(document.getElementById('word').value)
        }

        const fetchNext = async (word) => {
            currentWord = await (await fetch(`/api/word/${word || ''}`)).json()
            document.getElementById('word').value = currentWord.word
            document.getElementById('revealed').setAttribute('style', 'height: 7em; visibility: hidden;')
            document.getElementById('revealed').innerHTML = `
                <table style='width: calc(100% - 8px); font-size: .7em;'>
                    <tr><td>Pinyin</td><td><input id='pinyin' value='${currentWord.pinyin}'></input></td></tr>
                    <tr><td>Meaning</td><td><input id='meaning' value='${currentWord.meaning}'></input></td></tr>
                    <tr><td>Sentences</td><td><input id='sentences' value='${currentWord.sentences}'></input></td></tr>
                </table>`
        }
        fetchNext()
    </script>
</body>

</html>